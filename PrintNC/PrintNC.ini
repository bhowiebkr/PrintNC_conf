# PrintNC CNC Machine Configuration
# Originally generated by PNCconf - now manually maintained
# Machine: 3-axis router with dual Y motors (gantry configuration)
# Controller: Mesa 7i76e Ethernet I/O card
# Interface: QtDragon HD
# Units: mm (linear), mm/min (velocity), mm/sÂ² (acceleration)


[EMC]
# Machine name displayed in UI
MACHINE = PrintNC
# Debug level (0 = no debug messages)
DEBUG = 0
# Configuration version for tracking changes
VERSION = 1.1

[DISPLAY]
# QtDragon HD display configuration
# Spindle power rating in watts
MAX_SPINDLE_POWER =2200
DISPLAY = qtvcp qtdragon_hd
PREFERENCE_FILE_PATH = WORKINGFOLDER/qtdragon.pref
POSITION_OFFSET = RELATIVE
POSITION_FEEDBACK = ACTUAL
MAX_FEED_OVERRIDE = 2.000000
MAX_SPINDLE_0_OVERRIDE = 1.500000
MIN_SPINDLE_0_OVERRIDE = 0.500000
DEFAULT_SPINDLE_0_SPEED = 4000
MIN_SPINDLE_0_SPEED = 1000
MAX_SPINDLE_0_SPEED = 24000
INTRO_GRAPHIC = linuxcnc.gif
INTRO_TIME = 5
PROGRAM_PREFIX = /home/howard/GCODE
INCREMENTS = 5mm 1mm .5mm .1mm .05mm .01mm .005mm
POSITION_FEEDBACK = ACTUAL
DEFAULT_LINEAR_VELOCITY = 6.000000
MAX_LINEAR_VELOCITY = 25.000000
MIN_LINEAR_VELOCITY = 0.500000
DEFAULT_ANGULAR_VELOCITY = 12.000000
MAX_ANGULAR_VELOCITY = 180.000000
MIN_ANGULAR_VELOCITY = 1.666667
EDITOR = gedit
# Axes displayed in preview (xyz for 3-axis machine)
GEOMETRY = xyz
# Display update cycle time in ms
CYCLE_TIME = 100
# Default jog velocity in mm/min
DEFAULT_LINEAR_JOG_VEL = 1500

[MDI_COMMAND_LIST]
MDI_COMMAND = G53 G0 Z0; G0 X0 Y0; G0 Z0

[FILTER]
PROGRAM_EXTENSION = .ngc GCODE, .png,.gif,.jpg Greyscale Depth Image
PROGRAM_EXTENSION = .py Python Script
png = image-to-gcode
gif = image-to-gcode
jpg = image-to-gcode
py = python

[TASK]
TASK = milltask
CYCLE_TIME = 0.010

[RS274NGC]
PARAMETER_FILE = linuxcnc.var
SUBROUTINE_PATH = subroutines
# Tool change remapping with automatic tool height measurement
REMAP=M6 modalgroup=6 ngc=tool-change
REMAP=M600 modalgroup=6 ngc=tool-job-begin

[EMCMOT]
EMCMOT = motmod
COMM_TIMEOUT = 1.0
SERVO_PERIOD = 2000000

[HMOT]
# **** This is for info only ****
CARD0=hm2_7i76e.0

[HAL]
HALUI = halui
HALFILE = PrintNC.hal
HALFILE = custom.hal
POSTGUI_HALFILE = qtvcp_postgui.hal
POSTGUI_HALFILE = custom_postgui.hal
SHUTDOWN = shutdown.hal

[HALUI]

[KINS]
# Kinematics configuration for gantry machine
# 4 joints: X(0), Y1(1), Y2(2), Z(3)
JOINTS = 4
# Trivial kinematics with dual Y motors
KINEMATICS = trivkins coordinates=XYYZ

[TRAJ]
# Trajectory planner configuration
# Dual Y indicates gantry configuration
COORDINATES =  X Y Y Z
LINEAR_UNITS = mm
ANGULAR_UNITS = degree
DEFAULT_LINEAR_VELOCITY = 500.00
MAX_LINEAR_VELOCITY = 1500.00
POSITION_FILE = position.txt

[EMCIO]
EMCIO = io
CYCLE_TIME = 0.100
TOOL_TABLE = tool.tbl
TOOL_CHANGE_QUILL_UP = 1

# ==========================================
# X AXIS CONFIGURATION
# ==========================================
[AXIS_X]
MAX_VELOCITY = 504.0
MAX_ACCELERATION = 1125.0
MIN_LIMIT = -0.0
MAX_LIMIT = 772.0

[JOINT_0]
# X axis motor configuration
TYPE = LINEAR
# Home position after homing (mm)
HOME = 5.0
# Following error limits (mm)
FERROR = 10.0
MIN_FERROR = 1.0
MAX_VELOCITY = 504.0
MAX_ACCELERATION = 1125.0
# The values below should be 25% larger than MAX_VELOCITY and MAX_ACCELERATION
# If using BACKLASH compensation STEPGEN_MAXACCEL should be 100% larger.
STEPGEN_MAXVEL = 630.00
STEPGEN_MAXACCEL = 1406.00
P = 500.0
I = 0.0
D = 0.0
FF0 = 0.0
FF1 = 1.0
FF2 = 0.0
BIAS = 0.0
DEADBAND = 0.0
MAX_OUTPUT = 0.0
# these are in nanoseconds
DIRSETUP   = 400
DIRHOLD    = 400
STEPLEN    = 200
STEPSPACE  = 200
# Negative value inverts motor direction
# Calculated for belt drive and ballscrew pitch
STEP_SCALE = -500.0
BACKLASH = 0.0
MIN_LIMIT = -0.0
MAX_LIMIT = 780.0
HOME_OFFSET = -15.000000
HOME_SEARCH_VEL = -25.000000
HOME_LATCH_VEL = -0.333333
HOME_FINAL_VEL = 200
HOME_USE_INDEX = NO
HOME_IGNORE_LIMITS = YES
HOME_SEQUENCE = 0
# ==========================================
# Y AXIS CONFIGURATION (GANTRY)
# ==========================================
[AXIS_Y]
MAX_VELOCITY = 403.2
MAX_ACCELERATION = 750.0
MIN_LIMIT = -0.0
MAX_LIMIT = 555.0

[JOINT_1]
# Y1 motor (left side of gantry)
TYPE = LINEAR
# Home position after homing (mm)
HOME = 5.0
# Following error limits (mm)
FERROR = 10.0
MIN_FERROR = 1.0
MAX_VELOCITY = 403.2
MAX_ACCELERATION = 750.0
# The values below should be 25% larger than MAX_VELOCITY and MAX_ACCELERATION
# If using BACKLASH compensation STEPGEN_MAXACCEL should be 100% larger.
STEPGEN_MAXVEL = 630.00
STEPGEN_MAXACCEL = 938.00
P = 500.0
I = 0.0
D = 0.0
FF0 = 0.0
FF1 = 1.0
FF2 = 0.0
BIAS = 0.0
DEADBAND = 0.0
MAX_OUTPUT = 0.0
# these are in nanoseconds
DIRSETUP   = 400
DIRHOLD    = 400
STEPLEN    = 200
STEPSPACE  = 200
STEP_SCALE = -400.0
BACKLASH = 0.0
MIN_LIMIT = -0.0
MAX_LIMIT = 555.0
HOME_OFFSET = -10.000000
HOME_SEARCH_VEL = -25.000000
HOME_LATCH_VEL = -0.333333
HOME_FINAL_VEL = 80
HOME_USE_INDEX = NO
HOME_IGNORE_LIMITS = YES
# Negative HOME_SEQUENCE for synchronized homing with Y2
HOME_SEQUENCE = -1

[JOINT_2]
# Y2 motor (right side of gantry)
TYPE = LINEAR
# Home position after homing (mm)
HOME = 5.0
# Following error limits (mm)
FERROR = 10.0
MIN_FERROR = 1.0
MAX_VELOCITY = 403.2
MAX_ACCELERATION = 750.0
# The values below should be 25% larger than MAX_VELOCITY and MAX_ACCELERATION
# If using BACKLASH compensation STEPGEN_MAXACCEL should be 100% larger.
STEPGEN_MAXVEL = 630.00
STEPGEN_MAXACCEL = 938.00
P = 500.0
I = 0.0
D = 0.0
FF0 = 0.0
FF1 = 1.0
FF2 = 0.0
BIAS = 0.0
DEADBAND = 0.0
MAX_OUTPUT = 0.0
# these are in nanoseconds
DIRSETUP   = 400
DIRHOLD    = 400
STEPLEN    = 200
STEPSPACE  = 200
STEP_SCALE = -400.0
BACKLASH = 0.0
MIN_LIMIT = -0.0
MAX_LIMIT = 555.0
HOME_OFFSET = -10.000000
HOME_SEARCH_VEL = -25.000000
HOME_LATCH_VEL = -0.333333
HOME_FINAL_VEL = 80
HOME_USE_INDEX = NO
HOME_IGNORE_LIMITS = YES
HOME_SEQUENCE = -1
# ==========================================
# Z AXIS CONFIGURATION
# ==========================================
[AXIS_Z]
MAX_VELOCITY = 200.0
MAX_ACCELERATION = 1000.0
MIN_LIMIT = -162.5
MAX_LIMIT = 0.0

[JOINT_3]
# Z axis motor configuration
TYPE = LINEAR
# Home position after homing (mm)
HOME = -5.0
# Large FERROR for Z during probing operations
FERROR = 80000.0
MIN_FERROR = 10.0
MAX_VELOCITY = 200.0
MAX_ACCELERATION = 1000.0
# The values below should be 25% larger than MAX_VELOCITY and MAX_ACCELERATION
# If using BACKLASH compensation STEPGEN_MAXACCEL should be 100% larger.
STEPGEN_MAXVEL = 250.00
STEPGEN_MAXACCEL = 1250.00
P = 500.0
I = 0.0
D = 0.0
FF0 = 0.0
FF1 = 1.0
FF2 = 0.0
BIAS = 0.0
DEADBAND = 0.0
MAX_OUTPUT = 0.0
# these are in nanoseconds
DIRSETUP   = 400
DIRHOLD    = 400
STEPLEN    = 200
STEPSPACE  = 200
# Negative value inverts motor direction
# Updated from original -321.428571 for new leadscrew
STEP_SCALE = -514.285714
BACKLASH = 0.0
MIN_LIMIT = -175.0
MAX_LIMIT = 0.0
HOME_OFFSET = 0.500000
HOME_SEARCH_VEL = 8.333333
HOME_LATCH_VEL = 0.333333
HOME_FINAL_VEL = 83.333333
HOME_USE_INDEX = NO
HOME_IGNORE_LIMITS = YES
# Home Z axis first (sequence 0)
HOME_SEQUENCE = 0

# ==========================================
# SPINDLE CONFIGURATION
# ==========================================
[SPINDLE_0]
# PID parameters for spindle speed control
P = 0
I = 0
D = 0
FF0 = 1
FF1 = 0
FF2 = 0
BIAS = 0
DEADBAND = 0
# Maximum spindle command output
MAX_OUTPUT = 2000

# ==========================================
# PROBE CONFIGURATION
# ==========================================
[PROBE]
# Probe screen type
USE_PROBE = basicprobe

# ==========================================
# MANUAL TOOL CHANGE CONFIGURATION
# ==========================================
[MANUAL_TOOL_CHANGE]
# Tool change and touch-off sensor positions in machine coordinates

# Position to move to for manual tool changes (mm)
CHANGE_POS_X = 300
CHANGE_POS_Y = 30

# Safe Z height to move to during tool changes (mm)
# Negative value means relative to current position
SAFE_Z_HEIGHT = -1

# Tool height sensor absolute position (mm)
# Machine moves here for automatic tool touch-off
TOUCH_SENSOR_POS_X = 359.5
TOUCH_SENSOR_POS_Y = 374.1

# Probing parameters for tool height measurement
# Maximum distance to probe downward (mm)
PROBE_SEARCH_DIST = 80
# Initial fast probe speed (mm/min)
ROUGH_PROBE_SPEED = 500
# Final slow probe speed for accuracy (mm/min)
FINE_PROBE_SPEED = 30
# Distance to back off after touching sensor (mm)
TOUCH_OFF_DIST = 5
